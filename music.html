<!DOCTYPE html>
<html>
    <head>
        <title>music - olivia's site</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="container">
            <h1>my song of the day</h1>
            <p>songs will appear here</p>
            <a href="index.html">← back to home</a>

            <button id="openModalBtn">post a song</button>
        </div>
    </body>

    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" id="closeModalBtn">&times;</span>
          <h2>Post a New Song</h2>
          <form id="songForm">
            <input type="text" id="songTitle" placeholder="Song Title" required><br>
            <input type="text" id="artistName" placeholder="Artist Name" required><br>
            <textarea id="description" placeholder="Write a description..." required></textarea><br>
            <input type="url" id="songLink" placeholder="Spotify or YouTube link" required><br>
            <button type="submit">Post</button>
          </form>
        </div>
      </div>
      
      <script>
        const openBtn = document.getElementById("openModalBtn");
        const closeBtn = document.getElementById("closeModalBtn");
        const modal = document.getElementById("modal");
        const form = document.getElementById("songForm");
        const songContainer = document.createElement("div");
        document.body.appendChild(songContainer);
      
        openBtn.onclick = () => modal.style.display = "block";
        closeBtn.onclick = () => modal.style.display = "none";
      
        window.onclick = (e) => {
          if (e.target === modal) modal.style.display = "none";
        };

        //load saved posts when page refreshes
        window.onload = function () {
            const savedPosts = localStorage.getItem("songPosts");
            if (savedPosts) {
                songContainer.innerHTML = savedPosts;
            }
        };
      
        form.onsubmit = (e) => {
          e.preventDefault();
          
          const title = document.getElementById("songTitle").value;
          const artist = document.getElementById("artistName").value;
          const description = document.getElementById("description").value;
          const link = document.getElementById("songLink").value;
      
          const songDiv = document.createElement("div");
          songDiv.innerHTML = `
            <h3>${title} – ${artist}</h3>
            <p>${description}</p>
            <div>${embedLink(link)}</div>
            <hr>
          `;
          songContainer.prepend(songDiv);

        // Save updated posts to localStorage
        localStorage.setItem("songPosts", songContainer.innerHTML);
      
          form.reset();
          modal.style.display = "none";
        };
      
        function embedLink(link) {
          if (link.includes("youtube.com") || link.includes("youtu.be")) {
            const embedUrl = link.replace("watch?v=", "embed/").replace("youtu.be/", "www.youtube.com/embed/");
            return `<iframe width="300" height="169" src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
          } else if (link.includes("spotify.com")) {
            return `<iframe style="border-radius:12px" src="${link.replace("track/", "embed/track/")}" width="300" height="80" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`;
          } else {
            return `<a href="${link}" target="_blank">${link}</a>`;
          }
        }
      </script>
      
</html>
